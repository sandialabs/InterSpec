<?xml version="1.0" encoding="UTF-8"?>
<!--
  This file contains tool definitions that will be loaded into the LLM system.
  All tools defined here will override the default hardcoded definitions in C++.

  To customize tool behavior, copy this file to your OS provided data directory for InterSpec
  (same location as llm_config.xml - see "Help" > "About InterSpec" > "Data" for the actual location).
-->

<LlmConfig version="0">
<ToolDefinitions version="0">

  <!-- Peak Detection and Analysis Tools -->

  <Tool name="get_detected_peaks">
    <Description>Returns all Regions Of Interest (ROI) with peaks detected by automated peak search, or that has been added to the internal analysis peak state. For ROI gives lower and upper energies, and for each peak it gives energy (in keV), FWHM, amplitude (area), statistical significance (numSigma), and if an analysis peak (isAnalysisPeak); if the peak is associated with a source, will also give that information.  Additional peaks may be fittable in data, as the automated peak search algorithm is not perfect.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
          "specType": {
            "type": "string",
            "description": "Which displayed spectrum to search for peaks in; the user is almost always interested in the Foreground, except to check if a peak is in both the foreground and background.",
            "enum": ["Foreground", "Background", "Secondary"]
          },
          "NonBackgroundPeaksOnly": {
            "type": "boolean",
            "description": "Optional: If specified true, only peaks without a corresponding background spectrum peak, or peaks notably elevated over the background, will be returned. May only be specified true for the 'Foreground' spectrum, and only if a background spectrum is loaded.  If not specified, all peaks for the spectrum are returned."
          },
          "lowerEnergy": {
            "type": "number",
            "description": "Optional: minimum energy (in keV) for peaks to return. If not specified, no lower bound is applied."
          },
          "upperEnergy": {
            "type": "number",
            "description": "Optional: maximum energy (in keV) for peaks to return. If not specified, no upper bound is applied."
          }
      },
      "required": ["specType"]
    }</ParametersSchema>
  </Tool>

  <Tool name="get_analysis_peaks">
    <Description>Gets the peaks selected to use for further analysis that have either been manually added by the user, or by the 'add_analysis_peak' tool call, or similar.  These peaks are tracked by an internal state, and are used for things like activity/shielding fitting and tracking nuclides identified.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
          "specType": {
            "type": "string",
            "description": "Optional: Which displayed spectrum to search for peaks in; if not specified will use foreground (which is what user usually wants).",
            "enum": ["Foreground", "Background", "Secondary"]
          },
          "lowerEnergy": {
            "type": "number",
            "description": "Optional: minimum energy (in keV) for peaks to return. If not specified, no lower bound is applied."
          },
          "upperEnergy": {
            "type": "number",
            "description": "Optional: maximum energy (in keV) for peaks to return. If not specified, no upper bound is applied."
          }
      }
    }</ParametersSchema>
  </Tool>

  <Tool name="get_identified_sources">
    <Description>Returns a list of unique sources (nuclides, x-ray elements, or reactions) that are currently assigned to user peaks in the specified spectrum. Each source appears only once in the list, even if multiple peaks are assigned to that source. Also includes user-defined labels that do not contain 'unknown'. This is useful for getting an overview of what sources have been identified in the spectrum.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
          "specType": {
            "type": "string",
            "description": "Optional: Which displayed spectrum to get identified sources from; if not specified will use foreground (which is what user usually wants).",
            "enum": ["Foreground", "Background", "Secondary"]
          }
      }
    }</ParametersSchema>
  </Tool>

  <Tool name="get_unidentified_peaks">
    <Description>Returns the list of foreground peaks (either detected by the auto peak search algorithm or in the internal analysis peak state) that do not have a source (nuclide, x-ray element, or reaction) assigned to them, and that are not consistent with the background spectrum (if present) peaks. Results are sorted by amplitude (largest first) and limited to the specified maximum number of results.  If a peak is coincident with a peak in the background spectrum (but elevated, or else it would not be returned), then the amount of elevation will also be returned.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "max_results": {
          "type": "integer",
          "description": "Maximum number of peaks to return, sorted by amplitude (largest first). Defaults to 5 if not specified.",
          "minimum": 1,
          "default": 5
        },
        "verbose": {
          "type": "boolean",
          "description": "If false (default and recomended), returns list of peaks with essential information (energy, FWHM, amplitude, cps, uncertainty, etc).  If true, includes further information like ROI bounds, continuum type, what its marked to use for, etc.",
          "default": false
        }
      }
    }</ParametersSchema>
  </Tool>

  <Tool name="add_analysis_peak">
    <Description>Fit and add a peak to the users peaks, at approximately the specified energy, optionally associating a source with it.  Returns Region Of Interest that was either created, or the peak was added to.  If fit failed, reason will be described in 'error' field.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
          "energy": {
            "type": "number",
            "description": "Approximate energy (in keV) to look for a peak to fit."
          },
          "source": {
            "type": "string",
            "description": "Optional: The parent nuclide (ex U235, I131, Ba133) or x-ray fluorescence element (ex Pb, U, W) or nuclear reaction (ex H(n,g)) assigned to the peak."
          },
          "specType": {
            "type": "string",
            "description": "Optional: Which displayed spectrum to search for peaks in; if not specified will use foreground (which is what user usually wants).",
            "enum": ["Foreground", "Background", "Secondary"]
          },
          "DoNotAddToAnalysisPeaks": {
            "type": "boolean",
            "description": "Optional: if true, the fit peak will not be added to the users analysis peaks, and instead the fit values will just be returned; defaults to false (i.e., peaks are added by default)."
          }
      },
      "required": ["energy"]
    }</ParametersSchema>
  </Tool>

  <Tool name="edit_analysis_peak">
    <Description>Edit or delete a peak at approximately the specified energy. Can modify peak properties (energy, FWHM, amplitude and their uncertainties), ROI bounds (lower/upper), continuum type (None, Constant, Linear, Quadratic, Cubic, FlatStep, LinearStep, BiLinearStep, External), skew type (NoSkew, Bortel, GaussExp, CrystalBall, ExpGaussExp, DoubleSidedCrystalBall), assign source (nuclide like Ba133, Co60 1332.49 keV, xray like Pb, or reaction like H(n,g)), set peak color (CSS color string), set user label, set flags for energy calibration/shielding/efficiency usage, delete peak, split peak into its own ROI, or merge ROI with adjacent peak.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
          "energy": {
            "type": "number",
            "description": "Energy (in keV) of the peak to edit; will find nearest peak within 1 FWHM."
          },
          "editAction": {
            "type": "string",
            "description": "Action to perform on the peak",
            "enum": ["SetEnergy", "SetFwhm", "SetAmplitude", "SetEnergyUncertainty", "SetFwhmUncertainty", "SetAmplitudeUncertainty", "SetRoiLower", "SetRoiUpper", "SetSkewType", "SetContinuumType", "SetSource", "SetColor", "SetUserLabel", "SetUseForEnergyCalibration", "SetUseForShieldingSourceFit", "SetUseForManualRelEff", "DeletePeak", "SplitFromRoi", "MergeWithLeft", "MergeWithRight"]
          },
          "doubleValue": {
            "type": "number",
            "description": "Numeric value for actions that require a number (SetEnergy, SetFwhm, SetAmplitude, SetRoiLower, SetRoiUpper, and uncertainty variants)"
          },
          "stringValue": {
            "type": "string",
            "description": "String value for SetSource (e.g., Ba133, Co60 1332.49 keV), SetColor (CSS color), SetUserLabel (text note), SetSkewType (NoSkew/Bortel/GaussExp/CrystalBall/ExpGaussExp/DoubleSidedCrystalBall), or SetContinuumType (None/Constant/Linear/Quadratic/Cubic/FlatStep/LinearStep/BiLinearStep/External)"
          },
          "boolValue": {
            "type": "boolean",
            "description": "Boolean value for SetUseForEnergyCalibration, SetUseForShieldingSourceFit, or SetUseForManualRelEff actions"
          },
          "specType": {
            "type": "string",
            "enum": ["Foreground", "Background", "Secondary"],
            "description": "Optional: Which spectrum the peak is in (default: Foreground)"
          }
      },
      "required": ["energy", "editAction"]
    }</ParametersSchema>
  </Tool>

  <Tool name="escape_peak_check">
    <Description>Check if a peak at a specified energy is a single or double escape peak of another peak in the spectrum. Returns the parent peak information if found, plus calculated energies where potential escape peaks or parent peaks could exist.  If the parent peak is found, and it has an assigned source, a "sourceLabel" will be returned that can be used to set the peaks source, or if the parent peak does not have a source, a "userLabel" will be returned that should be used to set the peaks user-label.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
          "energy": {
            "type": "number",
            "description": "Energy (in keV) of the peak to check for being an escape peak, or to calculate potential escape peak energies for."
          },
          "specType": {
            "type": "string",
            "enum": ["Foreground", "Background", "Secondary"],
            "description": "Optional: Which displayed spectrum to check (default: Foreground)."
          }
      },
      "required": ["energy"]
    }</ParametersSchema>
  </Tool>

  <Tool name="sum_peak_check">
    <Description>Check if a peak at a specified energy is a sum peak, where two lower-energy photons are detected simultaneously and their energies add together. There are two types: (1) Cascade-sum peaks occur when a nuclide emits two photons nearly simultaneously during decay and the detector is close enough to detect both (typically &lt;15 cm). Both contributing peaks must have the same nuclide source assigned. (2) Random-sum peaks (pile-up) occur when unrelated photons arrive simultaneously, typically when dead time is high (&gt;20% for HPGe, &gt;10% for low-resolution detectors). The function returns the sum type (CascadeSum, RandomSum, Unknown, or NotASumPeak), information about the two contributing peaks (energy, area, source), and appropriate labels (sourceLabel or userLabel) that can be used to identify the peak. When multiple candidate peak pairs are found, the best match is selected based on closest energy match, or if energies are similar, the pair with largest combined areas. An optional distance parameter can be provided to disable cascade-sum detection if the source is far from the detector (&gt;15 cm).</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
          "energy": {
            "type": "number",
            "description": "Energy (in keV) of the peak to check for being a sum peak."
          },
          "specType": {
            "type": "string",
            "enum": ["Foreground", "Background", "Secondary"],
            "description": "Optional: Which displayed spectrum to check (default: Foreground)."
          },
          "distance": {
            "type": "string",
            "description": "Optional: Source-to-detector distance (e.g., '10 cm', '1 m', '50 mm'). If greater than 15 cm, cascade-sum detection is disabled and only random-sum peaks are considered. If not specified, both types are checked."
          }
      },
      "required": ["energy"]
    }</ParametersSchema>
  </Tool>


  <Tool name="add_analysis_peaks_for_source">
    <Description>Fits, and adds to the analysis peaks all of the detectable peaks for the one or more specified sources.
    For sources with multiple peaks, will very likely do a much better job than individually fitting peaks for a source, and will do it much more efficiently and with a single tool call.
    If you want to fit peaks for a source that has multiple gamma or x-ray energies, use this function.
    The peaks added to the analysis peaks will have their respective source assigned to them.
    If you wish to fit for just just the NORM background peaks call with no source but with the FitNormBkgrndPeaks option, like `{ source: null, options: ["FitNormBkgrndPeaks"] }`.
    If there were any peaks for the source already added to the analysis peaks, they will be replaced with the results of this fit unless the "DoNotUseExistingRois" option is specified.
    Returns simplified peak information (energy, fwhm, amplitude, amplitudeUncert, numSigma, cps, and source) for the peaks that were fit.
    </Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "source": {
          "anyOf": [
            {"type": "string"},
            {"type": "null"},
            {"type": "array", "items": {"anyOf": [{"type": "string"}, {"type": "null"}]}}
          ],
          "description": "Required. The nuclide, x-ray element, or reaction, or array of these values, to fit peaks for (ex `'U235'`, `'I131'`, `['U235','U','Mn(a,a)']`). May be null or omitted only when 'FitNormBkgrndPeaks' is specified in options, in which case only NORM background nuclide peaks are fit."
        },
        "options": {
          "type": "array",
          "items": {
            "type": "string",
            "oneOf": [
              {
                "const": "DoNotAddToUserSession",
                "description": "Fitted peaks will not be added to the user's peak collection; useful when only inspecting fit results."
              },
              {
                "const": "DoNotUseExistingRois",
                "description": "Any existing user ROI that overlaps a source gamma energy is ignored; gammas falling within those ROIs are excluded from the fit entirely."
              },
              {
                "const": "ExistingPeaksAsFreePeak",
                "description": "Normally the ROI extent for a source peak is restricted to reduce interference from nearby peaks, not from this source; with this option those nearby peaks are instead included in the ROI as freely-floating peaks and are effectively refit."
              },
              {
                "const": "DoNotVaryEnergyCal",
                "description": "The energy calibration is held fixed throughout the fit."
              },
              {
                "const": "FitNormBkgrndPeaks",
                "description": "NORM background nuclide peaks (e.g. K40, Th232, Ra226, U238) are fit using a separate relative efficiency curve; the resulting peaks are included in the results."
              }
            ]
          },
          "description": "Optional: array of option flags controlling the fit behaviour."
        }
      },
      "required": ["source"]
    }</ParametersSchema>
  </Tool>


  <!-- Spectrum Information Tools -->

  <Tool name="get_spectrum_info">
    <Description>Get basic information about the currently loaded spectrum</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
          "specType": {
            "type": "string",
            "description": "Which spectrum to get info for",
            "enum": ["Foreground", "Background", "Secondary"]
          }
      },
      "required": ["specType"]
    }</ParametersSchema>
  </Tool>

  <Tool name="loaded_spectra">
    <Description>Returns array of the currently loaded spectra from ["Foreground", "Background", "Secondary"].  If no spectra are loaded, returns empty array.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
      }
    }</ParametersSchema>
  </Tool>

  <Tool name="get_counts_in_energy_range">
    <Description>Get the photon counts in the spectra for the specified energy range, as well as compares statistical significance of differences between foreground and background and/or secondary count-rates, if those spectra are loaded.  This function can be used to check if the count rate of an energy range is elevated in the foreground relative to the background, especially above the 2614 keV peak.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "lowerEnergy": {
          "type": "number",
          "description": "The lower energy bound in keV."
        },
        "upperEnergy": {
          "type": "number",
          "description": "The upper energy bound in keV."
        }
      },
      "required": ["lowerEnergy", "upperEnergy"]
    }</ParametersSchema>
  </Tool>

  <Tool name="get_expected_fwhm">
    <Description>Calculate the expected Full Width at Half Maximum (FWHM) for a peak at the specified energy, based on the detector response function, detected peaks, or detector type. This is useful for determining the expected width of a peak for ROI calculations.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "energy": {
          "type": "number",
          "description": "The energy (in keV) to calculate the expected FWHM for."
        }
      },
      "required": ["energy"]
    }</ParametersSchema>
  </Tool>

  <Tool name="automated_source_id_results">
    <Description>Get the source (isotope, florescent x-ray, or nuclear reaction) ID from the available automated ID algorithms. Will return the detection systems on-board nuclide ID results, if present, as well as the GADRAS Full Spectrum Isotope ID results if the app is configured to get.  These automated results can be wrong or incomplete, so should used at most as a starting point, or something to check.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
      }
    }</ParametersSchema>
  </Tool>

  <!-- Nuclear Data Tools -->

  <Tool name="primary_gammas_for_source">
    <Description>Get the most likely energies a peak will be detected at for a source (nuclide, florescent x-ray, or nuclear reaction). Returns one to a few energies (in keV).  This is only a rough guess at the most prominent or unique peaks for the source; not detecting a peak at these energies does not rule out a source, but it makes the source a candidate.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "source": {
          "type": "string",
          "description": "The source (nuclide, x-ray element, or nuclear reaction) to get the characteristic gammas for."
        }
      },
      "required": ["source"]
    }</ParametersSchema>
  </Tool>

  <Tool name="sources_with_primary_gammas_in_energy_range">
    <Description>Get the commonly encountered field nuclides, x-ray elements, or reactions with primary gammas in the specified energy range.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "lowerEnergy": {
          "type": "number",
          "description": "The lower energy (in keV) to search for primary gammas."
        },
        "upperEnergy": {
          "type": "number",
          "description": "The upper energy (in keV) to search for primary gammas."
        }
      },
      "required": ["lowerEnergy", "upperEnergy"]
    }</ParametersSchema>
  </Tool>

  <Tool name="sources_with_primary_gammas_near_energy">
    <Description>Get the commonly encountered field nuclides, x-ray elements, or reactions with primary gammas near the specified energy.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "energy": {
          "type": "number",
          "description": "The energy (in keV) to search for primary gammas."
        }
      },
      "required": ["energy"]
    }</ParametersSchema>
  </Tool>
<!--
  <Tool name="sources_associated_with_source">
    <Description>Gets other sources (nuclides, reactions, x-rays) that are commonly detected along with the specified source, or sources that might be mis-identified as the specified source.  You you should check for these associated sources being present or not when the specified source is observed.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "source": {
          "type": "string",
          "description": "The source to get associated sources for."
        }
      },
      "required": ["source"]
    }</ParametersSchema>
  </Tool>

  <Tool name="analyst_notes_for_source">
    <Description>Gets analyst notes for the specified source (nuclide, x-ray, reaction), such as when the source is used/seen, typical activity ranges of nuclides, etc.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "source": {
          "type": "string",
          "description": "The source to get analyst notes for."
        }
      },
      "required": ["source"]
    }</ParametersSchema>
  </Tool>
-->

  <Tool name="source_info">
    <Description>Gets relevant information about the specified source (nuclide, x-ray element, reaction), such as half-life, decay modes, analyst notes (such as when the source is used/seen, typical activity ranges of nuclides, etc.), associated sources (i.e. sources that are commonly detected along with the specified source, or sources that might be mis-identified as the specified source - you should check for these associated sources being present or not when the specified source is observed), source categories (medical, NORM, industrial, etc), and other nuclear data.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "source": {
          "type": "string",
          "description": "The source to get data for."
        }
      },
      "required": ["source"]
    }</ParametersSchema>
  </Tool>

  <Tool name="nuclide_decay_chain">
    <Description>Returns a list of all progeny nuclides, of the specified nuclide, and their decay modes and branching ratios.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "nuclide": {
          "type": "string",
          "description": "The nuclide to get data for."
        }
      },
      "required": ["nuclide"]
    }</ParametersSchema>
  </Tool>

  <!-- TODO: consider adding escape peak option to "source_photons" -->
  <Tool name="source_photons">
    <Description>Returns a list of energy/intensity pairs associated with a nuclide, elemental fluorescence x-rays, or reaction.  The energies are expressed in keV, and intensities are given as photons per source Becquerel for nuclides, or normalized to 1 for fluorescence or reactions.  Results will be sorted by energy.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "Source": {
          "type": "string",
          "description": "The nuclide, element, or reaction for which to retrieve decay product data. Examples: 'U238' (nuclide), 'Pb' (element), 'H(n,g)' (reaction)."
        },
        "Age": {
          "type": "string",
          "description":  "The age of the nuclide at which to return decay products. Applicable only for nuclides; specifying this for elements or reactions will result in an error. If not specified for nuclides, a default age will be used. Examples: '23.25 y', '23 years 60 days', '0s', '5 half-lives'. An age of '0 seconds' will return products from the specified nuclide only, while a positive value will include products from the nuclide's full decay chain, aged to the specified amount."
        },
        "MaxResults": {
          "type": "integer",
          "minimum": 1,
          "description": "The maximum number of energy/intensity pairs to return; if the source has more than this number of photons, then information for this number of the largest intensity photons will be returned.  If not specified, a value of 125 will be assumed."
        },
        "IncludeCascadeSumEnergies": {
          "type": "boolean",
          "description": "Optional: default false. If true, results will also include a list of top gamma pairs that may sum (gammas emitted at the same time that may be detected together), and is only relevant for nuclide sources and measurements less than ~15 cm from the source. The 'MaxResults' argument also limits the max possible length of these results."
        }
      },
      "required": ["Source"]
    }</ParametersSchema>
  </Tool>

  <!-- Search and Identification Tools -->

  <Tool name="search_sources_by_energy">
    <Description>Searches for radiation sources (nuclides, x-rays, reactions) that have gammas, x-rays, alphas, and/or beta-end-point at specified energies. Returns candidate sources ranked by how well they match the input energies and current foreground spectrum.

It is best to only search on a single energy at a time, and only for foreground peaks whose source is not identified; do not search on multiple energies unless you are investigating or suspect they are from the same source, or are really having a hard time identifying a source.

The 'profile_score' metric (larger = better match) is the best indicator of fit quality for the loaded spectrum, considering peak heights and detector response.

Further investigation of top returned candidates is required to make sure they match the spectrum (e.g., the spectrum is not missing a peak it should have from that source, or the peaks in the spectrum have expected relative amplitudes, etc.)</Description>
<Description role="NuclideId">Your primary identification tool. Search for candidate nuclides by gamma energy. Use extensively with single-energy searches. The profile_score metric (higher=better) accounts for peak heights and detector response. Prefer single-energy searches - only use 2-3 energies if desperately needed.</Description>
<AvailableFor><Agent>MainAgent</Agent><Agent>NuclideId</Agent></AvailableFor>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "energies": {
          "type": "array",
          "description": "The energies the source MUST match.  Since the source must match ALL entries, it is best to only search on one to a few unidentified peaks at a time, ususally starting with only a single peak, and then moving to two only if no satisfactory answer can be found. You usually will not want to search on a foreground peak that roughly aligns in energy with a background peak (either auto-search peak, or user/analysis fit peak), unless the foreground peak CPS is substantially elevated relative to the background peak.",
          "items": {
            "type": "object",
            "properties": {
              "energy": {
                "type": "number",
                "description": "Energy in keV to search for"
              },
              "window": {
                "type": "number",
                "description": "Search window (±keV) around this energy. If not specified, defaults to the recomended window of 1.27 times the expected FWHM at that energy, or if expected FWHM cant be determined, 1.5 keV for HPGe detectors or 10 keV for other detector types.  If the expected FWHM is not known, then it is recomended to not specify this field."
              }
            },
            "required": ["energy"]
          },
          "minItems": 1,
          "description": "Array of energies to search for. Each source must have emissions matching ALL specified energies."
        },
        "source_category": {
          "type": "string",
          "enum": ["Nuclides + X-rays", "Nuclides, X-rays, Reactions", "Fluorescence x-rays", "Reactions", "Medical Nuclides", "Industrial Nuclides", "SNM", "NORM", "Field Encountered Sources", "Field Encountered Nuclides", "Nuclear Reactions", "Fission Products", "Alphas", "Beta Endpoint", "Un-aged Nuclides"],
          "description": "Category filter for source types to search. Default is 'Nuclides + X-rays'.  Note that 'Alphas' give the energy of the alpha particle, while 'Nuclear Reactions' is the category you want to get the gammas produced by reactions of alphas, betas, or neutrons interacting with materials."
        },
        "min_half_life": {
          "type": "string",
          "description": "Minimum nuclide half-life as a string (e.g., '10 s', '5 min', '1 h', '2 y'). Default is '100 m'."
        },
        "min_branching_ratio": {
          "type": "number",
          "description": "Minimum relative branching ratio (0.0 to 1.0). This is the aged gamma line BR divided by max intensity line. Default is 0.0."
        },
        "max_results": {
          "type": "integer",
          "description": "Maximum number of results to return. Default is 10."
        },
        "sort_by": {
          "type": "string",
          "enum": ["ProfileScore", "SumEnergyDifference"],
          "description": "Sort criterion: 'ProfileScore' (larger=better, considers spectrum fit and peak heights) or 'SumEnergyDifference' (smaller=better, simple energy distance). Default is 'ProfileScore'."
        }
      },
      "required": ["energies"]
    }</ParametersSchema>
  </Tool>

  <!-- Detection Limit and Efficiency Tools -->

  <Tool name="currie_mda_calc">
    <Description>Calculate Minimum Detectable Activity (MDA) and detection confidence intervals using Currie-style (ISO 11929) methodology. Determines if a peak is detectable at a specified energy. Returns decision threshold, detection limit, and confidence intervals - as well as if it looks like a peak is at the energy (see `peakPresentInData` in output). When nuclide and distance are specified, the response will also include activity calculations (detection limit in activity, or observed activity with ranges, etc.)</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "energy": {
          "type": "number",
          "description": "The energy (in keV) of the photopeak for which the detection limit is being calculated."
        },
        "detectionProbability": {
          "type": "number",
          "description": "Optional: Detection probability (confidence level), typically 0.95 for 95% confidence. Defaults to 0.95.",
          "minimum": 0.5,
          "maximum": 0.999,
          "default": 0.95
        },
        "additionalUncertainty": {
          "type": "number",
          "description": "Optional: Additional relative uncertainty to include (e.g., from detector response function uncertainties). Defaults to 0.0.",
          "minimum": 0.0,
          "default": 0.0
        },
        "nuclide": {
          "type": "string",
          "description": "Optional: Nuclide symbol (e.g., 'Cs137', 'U238'). When specified along with distance, activity calculations will be included in the response."
        },
        "distance": {
          "type": "string",
          "description": "Optional: Distance from source to detector face (e.g., '10 cm', '1 m'). Required for activity calculations when nuclide is specified."
        },
        "age": {
          "type": "string",
          "description": "Optional: Age of the nuclide (e.g., '1 year', '100 days'). If not specified, uses default age for the nuclide."
        },
        "shielding": {
          "type": "object",
          "description": "Optional: Defines the shielding used to attenuate gammas and x-rays. Shielding must be specified in one of two formats.",
          "oneOf": [{
            "type": "object",
            "properties": {
              "AD": {
                "type": "number",
                "description": "Areal density of the shielding material in g/cm²."
              },
              "AN": {
                "type": "number",
                "description": "Effective atomic number of the shielding material."
              }
            },
            "required": ["AD", "AN"],
            "additionalProperties": false
          },{
            "type": "object",
            "properties": {
              "Material": {
                "type": "string",
                "description": "The shielding material, specified as an element symbol or material name. Available material names are returned by the `get_materials` tool. Example: 'Fe' (which is equivalent to 'Iron'), or 'glass_plate', etc.  The full list is returned from `get_materials`."
              },
              "Thickness": {
                "type": "string",
                "description": "The thickness of the shielding material, specified as a string with units. Example: '1.25cm'."
              }
            },
            "required": ["Material", "Thickness"],
            "additionalProperties": false
          }]
        },
        "assertBackgroundSpectrum": {
          "type": "boolean",
          "description": "Optional: If true, treats the spectrum as a background spectrum with no signal present - set this to true if you know signal is not present in the spectrum. Defaults to false.",
          "default": false
        }
      },
      "required": ["energy"]
    }</ParametersSchema>
  </Tool>

  <Tool name="calculate_dose">
    <Description>Calculate gamma dose rate from a nuclide source at a specified distance. Computes dose using ANSI/ANS-6.1.1-1991 fluence-to-dose conversion factors (Anterior-Posterior orientation). Accounts for source activity, decay age, distance, and optional shielding. Returns dose rate in both Sv/hr and rem/hr.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "nuclide": {
          "type": "string",
          "description": "Nuclide symbol (e.g., 'Co60', 'Cs137', 'U238'). Use the exact format from the nuclide database."
        },
        "distance": {
          "type": "string",
          "description": "Distance from center of source to location of interest with units (e.g., '1 m', '3ft 5in', '100 cm'). Must be positive."
        },
        "activity": {
          "type": "string",
          "description": "Source activity with units (e.g., '1.2 kBq', '100 uCi', '1 mCi'). Supports metric prefixes (f, p, n, u, m, k, M, G, T) for both Becquerel and Curie."
        },
        "age": {
          "type": "string",
          "description": "Optional: Nuclide age with units (e.g., '0.5 y', '4y 4months', '100 days'). Strongly recomended to no be specified, unless an age of the source is explicitly known.  If not specified, and intelligent age will be used based on the nuclide."
        },
        "material": {
          "type": "string",
          "description": "Optional: Shielding material name (use with 'thickness'). Must be a valid material from get_materials tool. Example: 'Fe' (iron), 'Pb' (lead), 'concrete', etc. Cannot be used together with arealDensity/atomicNumber."
        },
        "thickness": {
          "type": "string",
          "description": "Optional: Material thickness with units (e.g., '1 cm', '5 mm', '0.25 in'). Used with 'material' parameter. Cannot be used together with arealDensity/atomicNumber."
        },
        "arealDensity": {
          "type": "number",
          "description": "Optional: Shielding areal density in g/cm² (range 0-240). Use with 'atomicNumber'. Provides an alternative to material/thickness specification. Cannot be used together with material/thickness."
        },
        "atomicNumber": {
          "type": "number",
          "description": "Optional: Shielding atomic number (range 1-98). Use with 'arealDensity'. Provides an alternative to material/thickness specification. Cannot be used together with material/thickness.",
          "minimum": 1,
          "maximum": 98
        }
      },
      "required": ["nuclide", "distance", "activity"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>MainAgent</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="photopeak_detection_efficiency">
    <Description>Given an array of source photon energies, returns the fraction of photons that will contribute to a peak in data. The returned answer will include the attenuation factor of shielding (if specified), the fraction of photons making it to the detector (if distance is specified), the detection probability of photons that are incident upon the detector (i.e., the intrinsic detection efficiency) if a detector efficiency function is loaded (use 'detector_efficiency_function_info' tool call with no arguments to see if a detector efficiency function is loaded, and 'available_detector_efficiency_functions' and 'load_detector_efficiency_function' to load an efficiency function), and gives total detection probability.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "Energies": {
          "type": "array",
          "items": {"type": "number"},
          "description": "Array of photon energies in keV"
        },
        "Distance": {
          "type": "string",
          "description": "Optional: Distance from source to detector face (e.g., '10 cm', '1 m')"
        },
        "Shielding": {
          "type": "array",
          "items": {
            "type": "object",
            "description": "Optional: Defines the shielding used to attenuate gammas and x-rays. Shielding must be specified in one of two formats.",
            "oneOf": [{
              "type": "object",
              "properties": {
                "AD": {
                  "type": "number",
                  "description": "Areal density of the shielding material in g/cm²."
                },
                "AN": {
                  "type": "number",
                  "description": "Effective atomic number of the shielding material."
                }
              },
              "required": ["AD", "AN"],
              "additionalProperties": false
            },{
              "type": "object",
              "properties": {
                "Material": {
                  "type": "string",
                  "description": "The shielding material, specified as an element symbol or material name. Available material names are returned by the `get_materials` tool. Example: 'Fe', which is equivalent to 'Iron', or 'glass_plate', which is returned from `get_materials`."
                },
                "Thickness": {
                  "type": "string",
                  "description": "The thickness of the shielding material, specified as a string with units. Example: '1.25cm'."
                }
              },
              "required": ["Material", "Thickness"],
              "additionalProperties": false
            }]
          },
          "description": "An array of shielding objects, applied in order from source to detector. Each shielding layer attenuates the photons that pass through it."
        }
      },
      "required": ["Energies"]
    }</ParametersSchema>
  </Tool>

  <!-- Detector Efficiency Tools -->

  <Tool name="available_detector_efficiency_functions">
    <Description>Returns a list of detector efficiency function names that can be loaded to the foreground spectrum.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {},
      "required": []
    }</ParametersSchema>
  </Tool>

  <Tool name="load_detector_efficiency_function">
    <Description>Loads a detector efficiency function to use for calculations. Can load from default available detectors, user previously used, filesystem path, GADRAS directory, or URI.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "identifier": {
          "type": "string",
          "description": "The detector efficiency function identifier. Can be a name from available_detector_efficiency_functions, a filesystem path to a detector file or GADRAS directory, or a URI. Required."
        },
        "detectorName": {
          "type": "string",
          "description": "Optional: The specific detector name to use when the identifier points to a file containing multiple detector efficiencies (e.g., RelEff CSV files). If not specified and the file contains only one detector, that detector will be used. If not specified and the file contains multiple detectors, an error will be returned."
        },
        "source": {
          "type": "string",
          "enum": ["DefaultAvailable", "UserPreviouslyUsed", "FilePath", "GadrasDirectory", "URI", "AnySource"],
          "description": "Optional: Source type hint for loading. DefaultAvailable: built-in detectors. UserPreviouslyUsed: user's database. FilePath: filesystem path to detector file. GadrasDirectory: GADRAS detector directory. URI: web URI. AnySource: try all options in order. Defaults to AnySource if not specified."
        }
      },
      "required": ["identifier"]
    }</ParametersSchema>
  </Tool>

  <Tool name="detector_efficiency_function_info">
    <Description>Returns information (name, description, if has FWHM info, or if is fixed geometry, etc) about either the currently loaded detector efficiency function, or if a name is specified, that detectors efficiency function.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Optional: The name of the detector efficiency function to return information about. If not specified, will return information about the currently loaded detector efficiency function."
          }
      },
      "required": []
    }</ParametersSchema>
  </Tool>

  <!-- Shielding and Material Tools -->

  <Tool name="get_materials">
    <Description>Returns a list of available materials for shielding. The materials name is what you will specify to other functions to use it as a shielding.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {},
      "additionalProperties": false
    }</ParametersSchema>
  </Tool>

  <Tool name="get_material_info">
    <Description>Returns shielding material information (density, effective atomic number, elemental mass fractions, etc).</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "material": {
          "type": "string",
          "description": "The shielding material name to get information about."
          }
      },
      "required": ["material"]
    }</ParametersSchema>
  </Tool>

  <!-- Activity/Shielding Fit Tools (ActivityFit Agent Only) -->

  <Tool name="activity_fit">
    <Description>Perform activity and shielding fitting using the current application state (GUI configuration). Requires the Activity/Shielding fit GUI to be open. Uses existing sources, shielding, and configuration from the GUI. Can fit nuclide ages when progeny peaks are present. Returns fitted activities, shielding parameters, fit quality metrics, and per-peak observed vs expected counts with source contributions.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "peak_energies": {
          "type": "array",
          "items": {"type": "number"},
          "description": "Optional: Peak energies in keV to filter which peaks are used for fitting. If not specified, uses all peaks marked for fitting in the GUI. Tolerance is max(peak FWHM, 1 keV). Peaks must already be assigned to nuclides."
        }
      }
    }</ParametersSchema>
    <AvailableFor>
      <Agent>ActivityFit</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="activity_fit_one_off">
    <Description>Perform a one-off activity and shielding fit with full specification. Does not use or modify GUI state. Ideal for custom fits where you want complete control over all parameters. Requires specifying distance, geometry, and peak energies. Can optionally specify sources and shielding, otherwise sources are auto-generated from peak nuclide assignments. Can fit nuclide ages when progeny peaks are present. Returns fitted activities, shielding parameters, fit quality metrics, and per-peak observed vs expected counts with source contributions.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "peak_energies": {
          "type": "array",
          "items": {"type": "number"},
          "description": "Peak energies in keV to use for fitting. Tolerance is `max(peak FWHM, 1 keV)`. Peaks must already be assigned to nuclides."
        },
        "distance": {
          "type": "string",
          "description": "Source-to-detector distance with units (e.g., '100 cm', '3 ft', '1.5 m'). If numeric value provided, assumes cm. Required for non-fixed-geometry detectors."
        },
        "geometry": {
          "type": "string",
          "enum": ["Spherical", "CylinderSideOn", "CylinderEndOn", "Rectangular"],
          "description": "Shielding geometry type. All shielding layers share this geometry. Default: Spherical for point sources."
        },
        "shielding": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "material": {
                "type": "string",
                "description": "Material name (e.g., 'Fe', 'Pb', 'Steel') or chemical formula (e.g., 'H2O')"
              },
              "radial_thickness": {
                "type": "string",
                "description": "Thickness with units for Spherical geometry (e.g., '0.5 cm', '2 mm'). If omitted, thickness will be fit. If specified, thickness is fixed unless fit_thickness is true."
              },
              "fit_thickness": {
                "type": "boolean",
                "description": "Whether to fit thickness as a parameter. Default: true if radial_thickness not specified, false otherwise."
              },
              "radius": {
                "type": "string",
                "description": "For CylinderSideOn or CylinderEndOn geometry: cylinder radius with units (e.g., '2.5 cm')"
              },
              "fit_radius": {
                "type": "boolean",
                "description": "Whether to fit cylinder radius"
              },
              "length": {
                "type": "string",
                "description": "For CylinderSideOn or CylinderEndOn geometry: cylinder length with units"
              },
              "fit_length": {
                "type": "boolean",
                "description": "Whether to fit cylinder length"
              },
              "width": {
                "type": "string",
                "description": "For Rectangular geometry: width dimension with units"
              },
              "fit_width": {
                "type": "boolean",
                "description": "Whether to fit width"
              },
              "height": {
                "type": "string",
                "description": "For Rectangular geometry: height dimension with units"
              },
              "fit_height": {
                "type": "boolean",
                "description": "Whether to fit height"
              },
              "depth": {
                "type": "string",
                "description": "For Rectangular geometry: depth dimension with units"
              },
              "fit_depth": {
                "type": "boolean",
                "description": "Whether to fit depth"
              },
              "trace_sources": {
                "type": "array",
                "description": "Optional: trace sources contaminating this shielding layer",
                "items": {
                  "type": "object",
                  "properties": {
                    "nuclide": {
                      "type": "string",
                      "description": "Nuclide symbol (e.g., 'Cs137', 'Co60')"
                    },
                    "activity_type": {
                      "type": "string",
                      "enum": ["per_cm3", "total_activity", "per_gram", "exponential"],
                      "description": "OPTIONAL: Type of trace source distribution. If not specified, auto-detected from activity string units. per_cm3 = volumetric contamination, total_activity = total activity in shielding, per_gram = mass-based contamination, exponential = surface contamination with exponential depth profile."
                    },
                    "activity": {
                      "type": "string",
                      "description": "Activity with units. AUTO-DETECTS activity_type from units: '1 Bq/cm3' or '1 Bq per cm3' -> per_cm3, '50 Bq/g' or '50 Bq per gram' -> per_gram, '10 uCi' -> total_activity. Supports metric prefixes (u, m, k, M, G) with Ci or Bq. Examples: '2.5 kBq/cm3', '100 Bq per cm3', '50 Bq/g', '25 Bq per gram', '10 uCi'."
                    },
                    "fit_activity": {
                      "type": "boolean",
                      "description": "Whether to fit the trace source activity. Default: true"
                    },
                    "relaxation_distance": {
                      "type": "string",
                      "description": "For exponential distribution only: characteristic length with units (e.g., '5 cm'). Not fittable."
                    }
                  },
                  "required": ["nuclide", "activity"]
                }
              }
            },
            "required": ["material"]
          },
          "description": "Array of shielding layers from innermost to outermost. All layers use the same geometry."
        },
        "sources": {
          "type": "array",
          "description": "Optional, and suggested to not specify: explicit source definitions - if you are okay accepting default nuclide ages (recomended), not fitting for age (recomended), and fitting for activity (by default you probably want to do this, unless you already know the source activity) - then you do not need to specify this sources array - instead the sources used will be defined by the nuclides associated with the peaks in the `peak_energies` argument.",
          "items": {
            "type": "object",
            "properties": {
              "nuclide": {
                "type": "string",
                "description": "Nuclide symbol (e.g., 'U238', 'Co60', 'Cs137')"
              },
              "fit_activity": {
                "type": "boolean",
                "description": "Whether to fit activity. Default: true for Point sources, false for Intrinsic (activity derived from shielding dimensions)"
              },
              "activity": {
                "type": "string",
                "description": "Initial activity guess with units (e.g., '10 uCi', '1 MBq'). Required for Point sources."
              },
              "fit_age": {
                "type": "boolean",
                "description": "Whether to fit nuclide age. Only allowed if: (1) nuclide has >= 2 unique progeny peaks assigned to it, or (2) this source is a dependent via age_defining_nuclide. Age fitting not allowed for nuclides reaching equilibrium quickly (e.g., Cs137). Default: false (opt-in only)"
              },
              "age": {
                "type": "string",
                "description": "Nuclide age with units (e.g., '20 years', '6 months', '100 days'). If numeric, assumes seconds."
              },
              "age_defining_nuclide": {
                "type": "string",
                "description": "For same_age_isotopes mode: symbol of the nuclide whose age this source shares. Isotopes of the same element (e.g., U235 and U238) typically have the same age. If specified, this source's age is controlled by the defining nuclide."
              },
              "source_type": {
                "type": "string",
                "enum": ["Point", "Trace", "Intrinsic"],
                "description": "Source type: Point = point source at center, Trace = trace contamination in shielding (specify via shielding.trace_sources), Intrinsic = self-attenuating source (nuclide is part of shielding material). Default: Point"
              }
            },
            "required": ["nuclide"]
          }
        },
        "options": {
          "type": "object",
          "description": "Optional fitting options",
          "properties": {
            "multiple_nucs_contribute_to_peaks": {
              "type": "boolean",
              "description": "Allow multiple nuclides to contribute to same peak. Default: true"
            },
            "attenuate_for_air": {
              "type": "boolean",
              "description": "Include air attenuation in model. Default: true"
            },
            "account_for_decay_during_meas": {
              "type": "boolean",
              "description": "Account for decay during measurement time. Default: false"
            },
            "photopeak_cluster_sigma": {
              "type": "number",
              "description": "Cluster nearby photopeaks within this many sigma. Default: 1.25"
            },
            "background_peak_subtract": {
              "type": "boolean",
              "description": "Subtract background peak contributions. Default: true"
            },
            "same_age_isotopes": {
              "type": "boolean",
              "description": "Isotopes of the same element share age (e.g., U235 and U238). Default: true"
            }
          }
        }
      },
      "required": ["distance", "geometry", "peak_energies"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>ActivityFit</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="get_shielding_source_config">
    <Description>Retrieve the current activity/shielding fit configuration from the application state (i.e., if "from_app_state" is used with the `activity_fit` tool). Returns distance, geometry, source definitions (with ages), shielding layers (with trace sources), and which peaks are marked for use in fitting.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {},
      "additionalProperties": false
    }</ParametersSchema>
    <AvailableFor>
      <Agent>ActivityFit</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="modify_shielding_source_config">
    <Description>Modify the activity/shielding fit configuration in the application state. Can add/remove shielding layers, remove sources, set distance, set geometry, set source ages, or set fitting options. Changes are saved to SpecMeas::m_shieldingSourceModel and updated in GUI if open. If dimension is specified when adding shielding (e.g., '0.5 inches'), it's fixed; if omitted, it will be fit.  To add a source you must use `mark_peaks_for_activity_fit` for peaks with the source you want to add.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "operation": {
          "type": "string",
          "enum": ["add_shielding", "remove_shielding", "remove_source", "set_distance", "set_geometry", "set_source_age", "set_fit_options"],
          "description": "Operation to perform on the configuration.  Note: the 'remove_source' option marks all peaks of the specified source to not be used in the fit."
        },
        "material": {
          "type": "string",
          "description": "For add_shielding: material name or formula. For remove_shielding: material name to remove (use either this or index)."
        },
        "index": {
          "type": "integer",
          "description": "For remove_shielding: zero-based index of shielding layer to remove (use either this or material)."
        },
        "radial_thickness": {
          "type": "string",
          "description": "For add_shielding with Spherical geometry: thickness with units. If specified, thickness is fixed; if omitted, will be fit."
        },
        "fit_thickness": {
          "type": "boolean",
          "description": "For add_shielding: explicit control over whether to fit thickness"
        },
        "radius": {
          "type": "string",
          "description": "For add_shielding with Cylinder geometry: radius with units"
        },
        "fit_radius": {
          "type": "boolean",
          "description": "For add_shielding: whether to fit cylinder radius"
        },
        "length": {
          "type": "string",
          "description": "For add_shielding with Cylinder geometry: length with units"
        },
        "fit_length": {
          "type": "boolean",
          "description": "For add_shielding: whether to fit cylinder length"
        },
        "geometry": {
          "type": "string",
          "enum": ["Spherical", "CylinderSideOn", "CylinderEndOn", "Rectangular"],
          "description": "For set_geometry: new geometry type. For add_shielding: geometry for the layer."
        },
        "distance": {
          "type": "string",
          "description": "For set_distance: new source-to-detector distance with units (e.g., '100 cm', '3 ft')"
        },
        "nuclide": {
          "type": "string",
          "description": "For add_source/remove_source/set_source_age: nuclide symbol"
        },
        "activity": {
          "type": "string",
          "description": "For add_source: initial activity with units (e.g., '10 uCi')"
        },
        "age": {
          "type": "string",
          "description": "For add_source or set_source_age: nuclide age with units (e.g., '20 years')"
        },
        "fit_age": {
          "type": "boolean",
          "description": "For add_source: whether to fit the age"
        },
        "source_type": {
          "type": "string",
          "enum": ["Point", "Trace", "Intrinsic"],
          "description": "For add_source: source type. Default: Point"
        },
        "attenuate_for_air": {
          "type": "boolean",
          "description": "For set_fit_options: whether to include air attenuation in the model. Default: true"
        },
        "multiple_nucs_contribute_to_peaks": {
          "type": "boolean",
          "description": "For set_fit_options: allow multiple nuclides to contribute to the same peak. Default: true"
        },
        "background_peak_subtract": {
          "type": "boolean",
          "description": "For set_fit_options: whether to subtract background peak contributions. Default: true"
        },
        "same_age_isotopes": {
          "type": "boolean",
          "description": "For set_fit_options: isotopes of the same element share the same age (e.g., U235 and U238). Default: true"
        }
      },
      "required": ["operation"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>ActivityFit</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="mark_peaks_for_activity_fit">
    <Description>Mark peaks to be used (or not used) in activity/shielding fitting. Equivalent of using the "SetUseForShieldingSourceFit" option for the `edit_analysis_peak` tool, but this provides a batch interface. Peaks are matched by energy with tolerance of max(peak FWHM, 1 keV).</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "peak_energies": {
          "type": "array",
          "items": {"type": "number"},
          "description": "Array of peak energies in keV to mark/unmark"
        },
        "use_for_fit": {
          "type": "boolean",
          "description": "Whether to use these peaks for fitting (true) or exclude them (false)"
        },
        "specType": {
          "type": "string",
          "enum": ["Foreground", "Background", "Secondary"],
          "description": "Optional: Which spectrum to operate on. Default: Foreground"
        }
      },
      "required": ["peak_energies", "use_for_fit"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>ActivityFit</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="close_activity_shielding_display">
    <Description>Close the Activity/Shielding fit GUI window (ShieldingSourceDisplay) if it is open. Does not affect the saved configuration state.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {},
      "additionalProperties": false
    }</ParametersSchema>
    <AvailableFor>
      <Agent>ActivityFit</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="ask_user_question">
    <Description>Ask the user a question via a modal dialog box and wait for their text response. Use sparingly - only when critical information is ambiguous and cannot be reasonably inferred. The dialog blocks other user interactions until answered. Prefer making reasonable assumptions based on context over asking questions.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "question": {
          "type": "string",
          "description": "The question to ask the user. Should be clear, concise, and explain why the information is needed."
        },
        "default_response": {
          "type": "string",
          "description": "Optional: pre-filled text in the response field to guide the user or suggest a default answer"
        }
      },
      "required": ["question"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>ActivityFit</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="set_workflow_state">
    <Description>Set the current workflow state for agents that use state machines. This tool is used by agents to track their progress through multi-step workflows and receive state-specific guidance. State machines are completely optional - agents without them can ignore this tool. The state machine provides soft enforcement: warnings are issued for unexpected transitions but the state change is still allowed. Each state has guidance text that helps the agent understand what to do next and which tools are typically needed in that state.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "state": {
          "type": "string",
          "description": "The name of the state to transition to. Valid state names are defined in the agent's state machine configuration in llm_agents.xml. Common states for isotopics workflows include: ANALYZE_REQUEST (understand user needs), SELECT_CONFIGURATION (choose appropriate preset), VALIDATE_CONFIGURATION (verify setup is correct), CHECK_INTERFERENCE (look for problematic peaks), EXECUTE_CALCULATION (run the analysis), EVALUATE_RESULTS (assess quality), FINALIZE_RESULTS (present to user)."
        },
        "notes": {
          "type": "string",
          "description": "Optional notes about why this state transition is being made or what was accomplished in the previous state. Helps with debugging and understanding the agent's reasoning."
        }
      },
      "required": ["state"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>NuclideId</Agent>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="list_isotopics_presets">
    <Description>List available isotopics analysis preset configurations. 
 Returns a list of preset files that can be loaded using load_isotopics_preset.
 Each preset contains pre-configured settings for specific analysis types like Plutonium isotopics, Uranium enrichment, etc. 
 The list includes a special 'Current Configuration' entry if any configuration is currently loaded to the applications internal state. 
 Presets define which nuclides to fit, which energy regions (ROIs) to analyze, detector resolution settings, and other analysis parameters. 
 The returned list of presets will contain descriptions for the presets that will help to determine which preset should be used as a starting point.
</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {}
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="get_isotopics_config">
    <Description>Retrieve the current isotopics analysis configuration. Returns detailed information about what is currently configured, including: which energy regions (ROIs) are defined for analysis, which nuclides will be fit in each relative efficiency curve, the energy calibration fit mode, and the detector resolution model (FWHM form). This allows the agent to verify the configuration is appropriate before running an analysis. Returns null if no configuration is loaded (use load_isotopics_preset first in that case).</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {}
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="reset_isotopics_config">
    <Description>Clear the current isotopics analysis configuration. This removes any loaded preset configuration and returns to a blank state. Use this when starting a fresh analysis or when the user wants to switch to a completely different analysis type. After resetting, you'll need to load a new preset using load_isotopics_preset before performing any analysis.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {}
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="load_isotopics_preset">
    <Description>Load an isotopics analysis preset configuration from a file into the applications internal state. 
The preset file contains the complete analysis configuration including which nuclides to fit, which energy ROIs to use, detector resolution settings, the energy calibration fit mode, and other options. 
In addition to loading the configuration to the internal application state, this tool call returns a detailed description of the current state that includes ROIs used, nuclide list, and analysis options.
Use list_isotopics_presets to discover the preset configurations available.
</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "preset": {
          "type": "string",
          "description": "The preset name or path to load. Can be: (1) a filename like 'PlutoniumIsotopics.xml' which will be found in data/rel_act recursively, (2) a filename without .xml extension (the extension will be added automatically), or (3) a full absolute path to a preset file. Use list_isotopics_presets to discover available presets."
        }
      },
      "required": ["preset"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="perform_isotopics_calculation">
    <Description>Execute isotopics analysis on the currently loaded spectrum using the configuration that was previously loaded via load_isotopics_preset. This performs the actual calculation to determine the mass fractions of isotopes from gamma-ray peak areas, detector response, and nuclear decay data. Before calling this tool, you MUST have: (1) a foreground spectrum loaded, (2) peaks fit to the spectrum, (3) an isotopics configuration loaded via load_isotopics_preset. The tool returns: mass fractions with uncertainties for each isotope, relative activities, ages (time since purification) if fit, quality metrics (chi-squared per degree of freedom), and optionally Pu242-corrected values for Plutonium analysis. Lower chi2/DOF (ideally near 1.0) indicates better fit quality. Values much greater than 2-3 may indicate problems with peak fits, interference, or incorrect configuration.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {}
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="modify_isotopics_nuclides">
    <Description>Modify nuclides in the currently loaded isotopics configuration.

The 'nuclides' parameter format matches the 'nuclides' array from get_isotopics_config output.
Use get_isotopics_config to see the current nuclides, then use this tool to add/remove/update them.

Actions:
- add: Add new nuclides to the configuration. Only 'name' is required; other fields use defaults if not specified.
- remove: Remove nuclides by name. Only the 'name' field is needed.
- update: Modify properties of existing nuclides. Only specify fields you want to change.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "action": {
          "type": "string",
          "enum": ["add", "remove", "update"],
          "description": "Action to perform on nuclides"
        },
        "nuclides": {
          "type": "array",
          "description": "Array of nuclide objects. Format matches 'nuclides' from get_isotopics_config.",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Nuclide symbol (e.g., 'Pu239', 'U235'). Required for all actions."
              },
              "age": {
                "type": "string",
                "description": "Optional. Nuclide age with units (e.g., '5 years', '20 days'). Time since purification. If not specified, uses current value (for update) or default age (for add)."
              },
              "fit_age": {
                "type": "boolean",
                "description": "Optional. Whether age should be fitted during analysis."
              },
              "age_min": {
                "type": "string",
                "description": "Optional. Minimum age bound for fitting (with units). Required if fit_age=true."
              },
              "age_max": {
                "type": "string",
                "description": "Optional. Maximum age bound for fitting (with units). Required if fit_age=true."
              },
              "min_rel_act": {
                "type": "number",
                "description": "Optional. Minimum relative activity constraint for fitting."
              },
              "max_rel_act": {
                "type": "number",
                "description": "Optional. Maximum relative activity constraint for fitting."
              }
            },
            "required": ["name"]
          }
        }
      },
      "required": ["action", "nuclides"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="modify_isotopics_rois">
    <Description>Modify energy ROIs (regions of interest) in the currently loaded isotopics configuration.

ROIs are identified by their energy bounds (lower_energy, upper_energy).
The 'rois' parameter format matches the 'rois' array from get_isotopics_config output.
Only specify fields you want to change - unspecified fields remain unchanged.

Actions:
- add: Add new ROIs to the configuration
- remove: Remove ROIs matching the specified energy bounds
- update: Modify properties of existing ROIs (continuum_type, range_type, or change bounds)
- replace_all: Replace all ROIs with the specified list

For update action: specify existing bounds to find the ROI, then new_lower_energy/new_upper_energy for new bounds.

Validation: ROIs may not overlap - tool returns error if overlapping ROIs would result.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "action": {
          "type": "string",
          "enum": ["add", "remove", "update", "replace_all"],
          "description": "Action to perform on ROIs"
        },
        "rois": {
          "type": "array",
          "description": "Array of ROI objects. Format matches 'rois' from get_isotopics_config.",
          "items": {
            "type": "object",
            "properties": {
              "lower_energy": {
                "type": "number",
                "description": "Lower energy bound in keV. Used to identify ROI for update/remove."
              },
              "upper_energy": {
                "type": "number",
                "description": "Upper energy bound in keV. Used to identify ROI for update/remove."
              },
              "new_lower_energy": {
                "type": "number",
                "description": "Optional. For update action: new lower energy bound if changing the ROI position."
              },
              "new_upper_energy": {
                "type": "number",
                "description": "Optional. For update action: new upper energy bound if changing the ROI position."
              },
              "continuum_type": {
                "type": "string",
                "description": "Optional. Continuum type for peak fitting. Valid values: Linear, Quadratic, Cubic, FlatStep, LinearStep, BiLinearStep.",
                "enum": ["Linear", "Quadratic", "Cubic", "FlatStep", "LinearStep", "BiLinearStep"]
              },
              "range_type": {
                "type": "string",
                "description": "Optional. How ROI bounds behave. Valid values: Fixed (bounds strictly enforced), CanExpandForFwhm (can expand to accommodate peak FWHM), CanBeBrokenUp (ROI can be broken up based on peaks).",
                "enum": ["Fixed", "CanExpandForFwhm", "CanBeBrokenUp"]
              }
            }
          }
        }
      },
      "required": ["action", "rois"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="modify_isotopics_curve_settings">
    <Description>Modify relative efficiency curve settings in the currently loaded isotopics configuration.

All parameters match the 'rel_eff_curve' structure from get_isotopics_config output.
Only specify fields you want to change - unspecified fields remain unchanged.

For physical models (FramPhysicalModel), can set use_hoerl and shielding.
For non-physical models (LnXLnY, LnX, LnY, etc.), can set rel_eff_eqn_order.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "rel_eff_eqn_type": {
          "type": "string",
          "description": "Optional. Relative efficiency equation type.",
          "enum": ["LnXLnY", "LnX", "LnY", "FramPhysicalModel"]
        },
        "rel_eff_eqn_order": {
          "type": "integer",
          "description": "Optional. Polynomial order for non-physical models (typically 2-6). Ignored for FramPhysicalModel.",
          "minimum": 1,
          "maximum": 8
        },
        "nucs_of_el_same_age": {
          "type": "boolean",
          "description": "Optional. Whether nuclides of same element should be constrained to same age."
        },
        "use_hoerl": {
          "type": "boolean",
          "description": "Optional. For FramPhysicalModel only: whether to use Hoerl form for rel eff equation."
        },
        "self_attenuation": {
          "type": "object",
          "description": "Optional. Self-attenuation (source material) for FramPhysicalModel. Set to null to remove.",
          "properties": {
            "material": {
              "type": "string",
              "description": "Optional. Material name (e.g., 'plutonium_dioxide', 'uranium_metal')."
            },
            "atomic_number": {
              "type": "number",
              "description": "Optional. Effective atomic number. Not needed if fitting, but if specified will be used as starting value. Cannot be used with 'material'."
            },
            "areal_density": {
              "type": "number",
              "description": "Optional. Areal density in g/cm2. Not needed if fitting, but if specified will be used as starting value. Cannot be used with 'thickness' (you can use one or the other)."
            },
            "thickness": {
              "type": "string",
              "description": "Optional. Thickness with units (e.g., '2.54 cm'). Only valid when 'material' is specified (not 'atomic_number'). Cannot be used with 'areal_density' (you can use one or the other)."
            },
            "fit_areal_density": {
              "type": "boolean",
              "description": "Optional. Whether to fit the areal density."
            },
            "fit_atomic_number": {
              "type": "boolean",
              "description": "Optional. Whether to fit the atomic number - it is usually not recommended to fit atomic number."
            }
          }
        },
        "external_attenuation": {
          "type": "array",
          "description": "Optional. External shielding layers for FramPhysicalModel. Set to empty array to remove all.",
          "items": {
            "type": "object",
            "properties": {
              "material": {
                "type": "string",
                "description": "Optional. Material name."
              },
              "atomic_number": {
                "type": "number",
                "description": "Optional. Effective atomic number. Not needed if fitting, but if specified will be used as starting value. Cannot be used with 'material'."
              },
              "areal_density": {
                "type": "number",
                "description": "Optional. Areal density in g/cm2. Not needed if fitting, but if specified will be used as starting value. Cannot be used with 'thickness' (you can use one or the other)."
              },
              "thickness": {
                "type": "string",
                "description": "Optional. Thickness with units (e.g., '2.54 cm'). Only valid when 'material' is specified (not 'atomic_number'). Cannot be used with 'areal_density' (you can use one or the other)."
              },
              "fit_areal_density": {
                "type": "boolean",
                "description": "Optional. Whether to fit the areal density."
              },
              "fit_atomic_number": {
                "type": "boolean",
                "description": "Optional. Whether to fit the atomic number - it is usually not recommended to fit atomic number."
              }
            }
          }
        }
      }
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="modify_isotopics_options">
    <Description>Modify global isotopics analysis options in the currently loaded configuration.

All parameters match the top-level fields from get_isotopics_config output.
Only specify fields you want to change - unspecified fields remain unchanged.

Note: background_subtract requires a background spectrum to be loaded.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "energy_cal_type": {
          "type": "string",
          "description": "Optional. Energy calibration fitting mode during analysis. NonLinearFit is default and recommended.",
          "enum": ["NoFit", "LinearFit", "NonLinearFit"]
        },
        "fwhm_form": {
          "type": "string",
          "description": "Optional. FWHM functional form for peak fitting.",
          "enum": ["Gadras", "SqrtEnergyPlusInverse", "ConstantPlusSqrtEnergy", "Polynomial_2", "Polynomial_3", "Polynomial_4", "Polynomial_5", "Polynomial_6"]
        },
        "fwhm_estimation_method": {
          "type": "string",
          "description": "Optional. How FWHM parameters are estimated.",
          "enum": ["StartFromDetEffOrPeaksInSpectrum", "StartFromDetectorEfficiency", "StartFromPeaksInSpectrum", "FixedToDetectorEfficiency"]
        },
        "skew_type": {
          "type": "string",
          "description": "Optional. Peak skew type for fitting.",
          "enum": ["NoSkew", "Bortel", "GaussExp", "CrystalBall", "ExpGaussExp", "DoubleSidedCrystalBall"]
        },
        "additional_br_uncert": {
          "type": "number",
          "description": "Optional. Additional branching ratio uncertainty (fractional, e.g., 0.05 for 5%).",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "background_subtract": {
          "type": "boolean",
          "description": "Optional. Whether to subtract background spectrum. Requires background to be loaded."
        },
        "show_ref_lines": {
          "type": "boolean",
          "description": "Optional. Whether to show reference lines in display."
        },
        "note": {
          "type": "string",
          "description": "Optional. User notes for this configuration."
        },
        "description": {
          "type": "string",
          "description": "Optional. Description of this configuration."
        }
      }
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="modify_isotopics_constraints">
    <Description>Modify activity ratio and mass fraction constraints in the currently loaded isotopics configuration.

Constraints are identified by the 'nuclide' field (the constrained nuclide).
Each nuclide can have at most one activity ratio constraint and one mass fraction constraint.

Actions:
- add: Add new constraints
- remove: Remove constraints for specified nuclides
- update: Modify existing constraints
- clear_all: Remove all constraints of the specified type

Validation: Referenced nuclides must exist in the configuration, and no circular constraint chains are allowed.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "action": {
          "type": "string",
          "enum": ["add", "remove", "update", "clear_all"],
          "description": "Action to perform on constraints"
        },
        "constraint_type": {
          "type": "string",
          "enum": ["activity_ratio", "mass_fraction"],
          "description": "Type of constraint to modify"
        },
        "constraints": {
          "type": "array",
          "description": "Array of constraint objects",
          "items": {
            "type": "object",
            "properties": {
              "nuclide": {
                "type": "string",
                "description": "The constrained nuclide (e.g., 'Pu240'). Required - identifies the constraint."
              },
              "relative_to": {
                "type": "string",
                "description": "The reference nuclide (e.g., 'Pu239'). Required for add action."
              },
              "ratio": {
                "type": "number",
                "description": "For activity_ratio: activity ratio of nuclide relative to reference (nuclide_activity / reference_activity). Example: 0.0612 means Pu240 has 6.12% the activity of Pu239."
              },
              "lower_fraction": {
                "type": "number",
                "description": "For mass_fraction: lower bound of mass fraction within the element. Example: 0.03 for minimum 3% U235 in uranium.",
                "minimum": 0.0,
                "maximum": 1.0
              },
              "upper_fraction": {
                "type": "number",
                "description": "For mass_fraction: upper bound of mass fraction within the element. Example: 0.20 for maximum 20% U235 in uranium.",
                "minimum": 0.0,
                "maximum": 1.0
              }
            },
            "required": ["nuclide"]
          }
        }
      },
      "required": ["action", "constraint_type"]
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="get_isotopics_config_schema">
    <Description>Get the schema and valid values for isotopics configuration fields.

Returns detailed information about all configurable fields including:
- Valid enum values for rel_eff_eqn_type, fwhm_form, skew_type, continuum_type, etc.
- Field descriptions and constraints
- Relationships between fields (e.g., use_hoerl only applies to FramPhysicalModel)

This information provides detailed explanation about the meaning of fields and options, as well as indicating valid options and relations.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {}
    }</ParametersSchema>
    <AvailableFor>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="peak_based_relative_efficiency">
    <Description>Perform a peak-based relative efficiency calculation using existing analysis peaks.

This tool performs relative efficiency analysis using peaks that have already been added to analysis peaks and have assigned sources. It is useful for:
- Validating nuclide identification: peaks that deviate significantly from the fit curve may not be the assigned nuclide
- Enrichment checks for Uranium or Plutonium isotopes
- Calculating relative activities/masses of fission products when geometry is unknown

Peaks can be specified either by energy list or by source nuclide list (mutually exclusive).

The output includes:
- Activity ratios and mass ratios between sources with uncertainties
- Per-peak information including observed vs fit efficiency
- The residual_sigma field indicates how close each peak is to the fit curve:
  * 0 to 5 sigma: Good - peak is consistent with the fit curve
  * 5 to 10 sigma: Acceptable - some deviation but still reasonable  
  * Beyond 10 sigma: Poor - peak is likely not the nuclide assigned, or there are other issues
- Fit quality metrics (chi2, dof, chi2_per_dof)
- Warnings about data quality or fitting issues

The save_to_state option allows persisting the configuration to the app state for later retrieval.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "peak_energies": {
          "type": "array",
          "description": "Array of peak energies in keV to use for the calculation. Mutually exclusive with 'sources'.",
          "items": {
            "type": "number"
          }
        },
        "sources": {
          "type": "array",
          "description": "Array of source nuclide names (e.g., 'U235', 'U238'). Uses all peaks assigned to these sources. Mutually exclusive with 'peak_energies'.",
          "items": {
            "type": "string"
          }
        },
        "eqn_form": {
          "type": "string",
          "description": "Relative efficiency equation form. Default: 'LnY'. Options: 'LnX' = polynomial in ln(energy), i.e., y = a + b*ln(x) + c*(ln(x))^2 + ...; 'LnY' = exponential of polynomial in 1/energy, i.e., y = exp(a + b*x + c/x + d/x^2 + ...); 'LnXLnY' = exponential of polynomial in ln(energy), i.e., y = exp(a + b*ln(x) + c*(ln(x))^2 + ...); 'FramEmpirical': y = exp(a + b/x^2 + c*ln(x) + d*(ln(x))^2 + e*(ln(x))^3); 'FramPhysicalModel' = detector intrinsic efficiency multiplied by shielding transmission efficiency (a default detector efficiency is used if a detector efficiency isnt loaded).",
          "enum": ["LnX", "LnY", "LnXLnY", "FramEmpirical", "FramPhysicalModel"]
        },
        "eqn_order": {
          "type": "integer",
          "description": "Polynomial order for the rel eff equation. Default: 3. Ignored for FramPhysicalModel.",
          "minimum": 1,
          "maximum": 8
        },
        "self_atten_shielding": {
          "type": "object",
          "description": "Self-attenuation shielding for FramPhysicalModel. Describes the source material that gamma rays originate from and must pass through (i.e. gammas treated as trace-sources in this volume). Only used when eqn_form is 'FramPhysicalModel'.",
          "properties": {
            "material": {
              "type": "string",
              "description": "Material name (e.g., 'UO2', 'Uranium', 'Steel'). Mutually exclusive with atomic_number. When using material, can specify either 'thickness' or 'areal_density'."
            },
            "atomic_number": {
              "type": "number",
              "description": "Atomic number (1-98). Use instead of material for generic shielding. Mutually exclusive with material. Requires 'areal_density'.",
              "minimum": 1,
              "maximum": 98
            },
            "thickness": {
              "type": "string",
              "description": "Thickness with units (e.g., '1.5 cm', '10 mm'). Only valid when using 'material'. Mutually exclusive with 'areal_density'."
            },
            "areal_density": {
              "type": "number",
              "description": "Areal density in g/cm2. Required when using 'atomic_number'. When using 'material', can specify either this or 'thickness'.",
              "minimum": 0
            },
            "fit_areal_density": {
              "type": "boolean",
              "description": "Whether to fit the areal density (or thickness). Default: true."
            },
            "fit_atomic_number": {
              "type": "boolean",
              "description": "Whether to fit the atomic number. Only valid when using atomic_number (not material). Default: false."
            }
          }
        },
        "external_shieldings": {
          "type": "array",
          "description": "External shielding layers for FramPhysicalModel. Describes shielding between source and detector. Only used when eqn_form is 'FramPhysicalModel'.",
          "items": {
            "type": "object",
            "properties": {
              "material": {
                "type": "string",
                "description": "Material name (e.g., 'Iron', 'Lead', 'Aluminum'). Mutually exclusive with atomic_number. When using material, can specify either 'thickness' or 'areal_density'."
              },
              "atomic_number": {
                "type": "number",
                "description": "Atomic number (1-98). Use instead of material for generic shielding. Mutually exclusive with material. Requires 'areal_density'.",
                "minimum": 1,
                "maximum": 98
              },
              "thickness": {
                "type": "string",
                "description": "Thickness with units (e.g., '1.5 cm', '10 mm'). Only valid when using 'material'. Mutually exclusive with 'areal_density'."
              },
              "areal_density": {
                "type": "number",
                "description": "Areal density in g/cm2. Required when using 'atomic_number'. When using 'material', can specify either this or 'thickness'.",
                "minimum": 0
              },
              "fit_areal_density": {
                "type": "boolean",
                "description": "Whether to fit the areal density (or thickness). Default: true."
              },
              "fit_atomic_number": {
                "type": "boolean",
                "description": "Whether to fit the atomic number. Only valid when using atomic_number (not material). Default: false."
              }
            }
          }
        },
        "match_tolerance": {
          "type": "number",
          "description": "Matching tolerance (in peak sigma) for accounting for interferening gammas that contiribute to the peak beyond the assigned gamma. Default: 1.5; a value of 0 means no interferences accounted for.",
          "minimum": 0.0
        },
        "background_subtract": {
          "type": "boolean",
          "description": "Whether to subtract background peaks that overlap with the specified signal peaks. Default: false (and usually doesnt matter unless peaks overlap with background)."
        },
        "additional_uncertainty": {
          "type": "string",
          "description": "Additional systematic uncertainty on the expected branching ratio of photopeaks. Default: 'StatOnly' (i.e., no additional uncertainty).",
          "enum": ["Unweighted", "StatOnly", "OnePercent", "FivePercent", "TenPercent", "TwentyFivePercent", "FiftyPercent", "SeventyFivePercent", "OneHundredPercent"]
        },
        "nuclide_ages": {
          "type": "object",
          "description": "Optional object mapping nuclide names to age strings - not recommended to be specified, {'U235': '20 years', 'U238': '4.5e9 years'}. Ages can be specified with units (years, days, half-lives, etc.) - if not specified, reasonable default ages will be used.",
          "additionalProperties": {
            "type": "string"
          }
        },
        "save_to_state": {
          "type": "boolean",
          "description": "If true, saves the configuration to app state for user to see, or for later retrieval. Default: false."
        }
      }
    }</ParametersSchema>
    <AvailableFor>
      <Agent>NuclideId</Agent>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="get_rel_act_manual_state">
    <Description>Retrieve the current RelActManual (peak-based relative efficiency) state.

Gets the current configuration state from either the GUI (if open) or from the spectrum file. This allows inspection of the current settings without performing a calculation.

Returns information about:
- Equation form and order
- Match tolerance and background subtraction settings
- Additional uncertainty setting
- Nuclide ages and decay correction flags
- Whether the state came from an open GUI or stored data</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {}
    }</ParametersSchema>
    <AvailableFor>
      <Agent>NuclideId</Agent>
      <Agent>Isotopics</Agent>
    </AvailableFor>
  </Tool>

  <Tool name="deep_research">
    <Description>Performs deep research about a gamma spectroscopy, or nuclear physics type question.  Queries an extensive RAG-based database of gamma-spectroscopy related information.  Do not use this tool for getting numerical information, or information that can be gotten from other tool calls.</Description>
    <ParametersSchema>{
      "type": "object",
      "properties": {
        "question": {
          "type": "string",
          "description": "The natural language question to be researched and answered."
        }
      },
      "required": ["question"]
    }</ParametersSchema>
  </Tool>

</ToolDefinitions>
</LlmConfig>
